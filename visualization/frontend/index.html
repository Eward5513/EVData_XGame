<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Geographic Data Visualization Platform</title>
    
    <!-- Cesium CSS -->
    <link href="Cesium-1.127/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div id="cesiumContainer" class="fullSize"></div>
    
    <!-- Speed Legend -->
    <div class="legend">
        <div class="legend-title">Speed Legend</div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: green;"></div>
            <div class="legend-text">0-10 km/h</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: yellow;"></div>
            <div class="legend-text">10-30 km/h</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: orange;"></div>
            <div class="legend-text">30-50 km/h</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: red;"></div>
            <div class="legend-text">50+ km/h</div>
        </div>
    </div>

    <!-- Control Panels Container -->
    <div class="panels-container">
        <!-- Vehicle Trajectory Panel -->
        <div id="vehiclePanel" class="control-panel">
            <div class="panel-header" data-panel="vehiclePanel">
                <h3>Vehicle Trajectory Visualization</h3>
                <div class="collapse-indicator">−</div>
            </div>
            <div class="panel-content">
            
            <div class="panel-section">
                <label for="vehicleMode">Vehicle Selection:</label>
                <select id="vehicleMode">
                    <option value="single" selected>Single Vehicle</option>
                    <option value="batch">First N Vehicles</option>
                    <option value="time_range">Time Range (All Vehicles)</option>
                </select>
            </div>
            
            <div class="panel-section" id="singleVehicleSection">
                <label for="vehicleId">Vehicle ID:</label>
                <input type="number" id="vehicleId" value="1" min="1" max="9999" style="width: 80px;">
            </div>
            
            <div class="panel-section" id="batchVehicleSection" style="display: none;">
                <label for="vehicleCount">First N Vehicles:</label>
                <input type="number" id="vehicleCount" value="3" min="1" max="50" style="width: 80px;">
                
                <div style="margin-top: 10px;">
                    <label for="batchDirection">Direction Filter:</label>
                    <select id="batchDirection" style="width: 120px;">
                        <option value="" selected>All Directions</option>
                        <option value="A1">A1 (N-S Straight)</option>
                        <option value="A2">A2 (N-S Left Turn)</option>
                        <option value="B1">B1 (E-W Straight)</option>
                        <option value="B2">B2 (E-W Left Turn)</option>
                        <option value="C">C (Right Turns & Other)</option>
                    </select>
                </div>
            </div>
            
            <div class="panel-section" id="timeRangeVehicleSection" style="display: none;">
                <label for="vehicleStartTime">Start Time:</label>
                <input type="time" id="vehicleStartTime" style="width: 100px;">
                <label for="vehicleEndTime">End Time:</label>
                <input type="time" id="vehicleEndTime" style="width: 100px;">
                <button id="loadVehicleTimeRangeBtn" class="btn btn-small">Load Time Range</button>
                
                <div style="margin-top: 10px;">
                    <label for="timeRangeDirection">Direction Filter:</label>
                    <select id="timeRangeDirection" style="width: 120px;">
                        <option value="" selected>All Directions</option>
                        <option value="A1">A1 (N-S Straight)</option>
                        <option value="A2">A2 (N-S Left Turn)</option>
                        <option value="B1">B1 (E-W Straight)</option>
                        <option value="B2">B2 (E-W Left Turn)</option>
                        <option value="C">C (Right Turns & Other)</option>
                    </select>
                </div>
                
                <div id="vehicleTimeRangeInfo" class="time-range-info" style="margin-top: 5px; font-size: 12px; color: #666;">
                    Click "Load Time Range" to see available time range for selected date
                </div>
            </div>
            
            <div class="panel-section">
                <label for="roadId">Road Intersection:</label>
                <select id="roadId">
                    <option value="A0003" selected>A0003</option>
                    <option value="A0008">A0008</option>
                </select>
            </div>
            
            <div class="panel-section">
                <label for="dateFilter">Date Filter:</label>
                <select id="dateFilter">
                    <option value="" selected>All Dates</option>
                </select>
                <button id="loadDatesBtn" class="btn btn-small">Load Dates</button>
            </div>
            
            <div class="panel-section">
                <label for="dataLimit">Data Points Count:</label>
                <select id="dataLimit">
                    <option value="">All</option>
                    <option value="100">100 points</option>
                    <option value="500">500 points</option>
                    <option value="1000">1000 points</option>
                    <option value="5000">5000 points</option>
                </select>
            </div>
            
            <div class="panel-section">
                <button id="loadDataBtn" class="btn btn-primary">Load Data</button>
                <button id="clearDataBtn" class="btn btn-secondary">Clear Data</button>
            </div>
            
            <div class="panel-section">
                <div id="dataInfo" class="data-info">
                    <div id="totalPoints">Total Points: --</div>
                    <div id="timeRange">Time Range: --</div>
                    <div id="speedRange">Speed Range: --</div>
                </div>
            </div>
            
            <div class="panel-section">
                <div id="status" class="status">
                    <span id="statusText">Ready</span>
                    <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>
                </div>
            </div>
            </div>
        </div>

        <!-- Traffic Light Panel -->
        <div id="trafficPanel" class="control-panel">
            <div class="panel-header" data-panel="trafficPanel">
                <h3>Traffic Light Status Query</h3>
                <div class="collapse-indicator">−</div>
            </div>
            <div class="panel-content">
            
            <div class="panel-section">
                <label for="trafficRoadId">Road Intersection:</label>
                <select id="trafficRoadId">
                    <option value="A0003" selected>A0003</option>
                    <option value="A0008">A0008</option>
                </select>
            </div>
            
            <div class="panel-section">
                <label for="cycleNum">Cycle Number:</label>
                <input type="number" id="cycleNum" value="1" min="1" max="50" style="width: 80px;">
                <button id="loadCyclesBtn" class="btn btn-small">Load Available Cycles</button>
            </div>
            
            <div class="panel-section">
                <button id="queryTrafficLightBtn" class="btn btn-primary">Query Traffic Light Status</button>
            </div>
            
            <div class="panel-section">
                <div id="trafficLightStatus" class="traffic-light-status">
                    <div class="status-message">No data queried yet. Click "Query Traffic Light Status" to view results.</div>
                </div>
            </div>
            
            <div class="panel-section">
                <div id="trafficStatus" class="status" style="display: none;">
                    <span id="trafficStatusText"></span>
                </div>
            </div>
            </div>
        </div>

        <!-- Intersection Topology Panel -->
        <div id="topologyPanel" class="control-panel">
            <div class="panel-header" data-panel="topologyPanel">
                <h3>Intersection Topology</h3>
                <div class="collapse-indicator">−</div>
            </div>
            <div class="panel-content">
            
            <div class="panel-section">
                <label for="topologyRoadId">Road Intersection:</label>
                <select id="topologyRoadId">
                    <option value="A0003" selected>A0003</option>
                    <option value="A0008">A0008</option>
                </select>
            </div>
            
            <div class="panel-section">
                <button id="loadTopologyBtn" class="btn btn-primary">Load Road Network</button>
                <button id="clearTopologyBtn" class="btn btn-secondary">Clear Network</button>
            </div>
            
            <div class="panel-section">
                <div id="topologyInfo" class="topology-info">
                    <div class="status-message">Click "Load Road Network" to display the intersection topology generated from trajectory analysis.</div>
                </div>
            </div>
            
            <div class="panel-section">
                <div id="topologyStatus" class="status" style="display: none;">
                    <span id="topologyStatusText"></span>
                </div>
            </div>
            </div>
        </div>

        <!-- Speed Analysis Panel -->
        <div id="speedPanel" class="control-panel">
            <div class="panel-header" data-panel="speedPanel">
                <h3>Speed Analysis</h3>
                <div class="collapse-indicator">−</div>
            </div>
            <div class="panel-content">
            
            <div class="panel-section">
                <label for="speedMode">Analysis Mode:</label>
                <select id="speedMode">
                    <option value="single" selected>Single Vehicle</option>
                    <option value="time_range">Time Range (All Vehicles)</option>
                </select>
            </div>
            
            <div class="panel-section" id="singleSpeedSection">
                <label for="speedVehicleId">Vehicle ID:</label>
                <input type="number" id="speedVehicleId" value="1" min="1" max="9999" style="width: 80px;">
                
                <div style="margin-top: 10px;">
                    <label for="singleSpeedDirection">Direction Filter:</label>
                    <select id="singleSpeedDirection" style="width: 120px;">
                        <option value="" selected>All Directions</option>
                        <option value="A1">A1 (N-S Straight)</option>
                        <option value="A2">A2 (N-S Left Turn)</option>
                        <option value="B1">B1 (E-W Straight)</option>
                        <option value="B2">B2 (E-W Left Turn)</option>
                        <option value="C">C (Right Turns & Other)</option>
                    </select>
                </div>
            </div>
            
            <div class="panel-section" id="timeRangeSpeedSection" style="display: none;">
                <label for="speedStartTime">Start Time:</label>
                <input type="time" id="speedStartTime" style="width: 100px;">
                <label for="speedEndTime">End Time:</label>
                <input type="time" id="speedEndTime" style="width: 100px;">
                <button id="loadTimeRangeBtn" class="btn btn-small">Load Time Range</button>
                
                <div style="margin-top: 10px;">
                    <label for="timeRangeSpeedDirection">Direction Filter:</label>
                    <select id="timeRangeSpeedDirection" style="width: 120px;">
                        <option value="" selected>All Directions</option>
                        <option value="A1">A1 (N-S Straight)</option>
                        <option value="A2">A2 (N-S Left Turn)</option>
                        <option value="B1">B1 (E-W Straight)</option>
                        <option value="B2">B2 (E-W Left Turn)</option>
                        <option value="C">C (Right Turns & Other)</option>
                    </select>
                </div>
                
                <div id="timeRangeInfo" class="time-range-info" style="margin-top: 5px; font-size: 12px; color: #666;">
                    Click "Load Time Range" to see available time range for selected date
                </div>
            </div>
            
            <div class="panel-section">
                <label for="speedRoadId">Road Intersection:</label>
                <select id="speedRoadId">
                    <option value="A0003" selected>A0003</option>
                    <option value="A0008">A0008</option>
                </select>
            </div>
            
            <div class="panel-section">
                <label for="speedDate">Date:</label>
                <select id="speedDate">
                    <option value="" selected>Select Date</option>
                </select>
                <button id="loadSpeedDatesBtn" class="btn btn-small">Load Dates</button>
            </div>
            
            <div class="panel-section">
                <label for="speedSegId">Seg ID:</label>
                <input type="number" id="speedSegId" placeholder="Optional" style="width: 80px;">
                <label style="margin-left:10px;" for="speedMetric">Metric:</label>
                <select id="speedMetric" style="width: 180px;">
                    <option value="speed" selected>speed</option>
                    <option value="acceleratorpedal">acceleratorpedal</option>
                    <option value="brakestatus">brakestatus</option>
                    <option value="gearnum">gearnum</option>
                    <option value="havebrake">havebrake</option>
                    <option value="havedriver">havedriver</option>
                </select>
            </div>
            
            <div class="panel-section">
                <button id="analyzeSpeedBtn" class="btn btn-primary">Analyze Speed</button>
            </div>
            
            <div class="panel-section">
                <div id="speedAnalysisStatus" class="speed-analysis-status">
                    <div class="status-message">Select vehicle(s) and date, then click "Analyze Speed" to view the speed chart.</div>
                </div>
            </div>
            
            <div class="panel-section">
                <div id="speedStatus" class="status" style="display: none;">
                    <span id="speedStatusText"></span>
                </div>
            </div>
            </div>
        </div>

        
    </div>

    <!-- Traffic Light Timeline Modal -->
    <div id="timelineModal" class="timeline-modal" style="display: none !important; visibility: hidden;">
        <div class="timeline-modal-content">
            <div class="timeline-modal-header">
                <h3 id="timelineModalTitle">Traffic Light Timeline</h3>
                <button id="closeTimelineModal" class="close-btn">&times;</button>
            </div>
            <div class="timeline-modal-body">
                <div id="timelineModalData"></div>
            </div>
        </div>
    </div>

    <!-- Speed Analysis Modal -->
    <div id="speedModal" class="speed-modal" style="display: none !important; visibility: hidden;">
        <div class="speed-modal-content">
            <div class="speed-modal-header">
                <h3 id="speedModalTitle">Speed Analysis Chart</h3>
                <button id="closeSpeedModal" class="close-btn">&times;</button>
            </div>
            <div class="speed-modal-body">
                <div id="speedChartContainer"></div>
            </div>
        </div>
    </div>

    <!-- Cesium JS -->
    <script src="Cesium-1.127/Build/Cesium/Cesium.js"></script>
    
    <!-- Custom JS -->
    <script src="js/app.js"></script>
</body>
</html>
